#include <stdio.h>
#include <stdlib.h>
//To represent an empty stack, EMPTY_TOS -1 is used
#define EMPTY_TOS -1
#define FALSE 0
#define TRUE 1
//Node declaration that will be used to store data in a stack
struct Node
{
    char val;
    struct Node *next;
};

//Declaration of a stack node
typedef struct Node StackRecord;
typedef StackRecord *Stack;

//Function signatures
Stack CreateStack();
void MakeEmptyStack(Stack);
void PushStack(char, Stack);
int PopStack(Stack);
int TopOfStack(Stack);
int IsEmptyStack(Stack);
void balanceStack(Stack, char *);


int main()
{
    Stack myStack;
    int exit, val;
    char command;
    char input[100];

    myStack = CreateStack();

    exit = FALSE;

    while (!exit)
    {
        fflush(stdin);
        printf("Enter command t)op of stack P)arsing e)xit: ");
        scanf("%c", &command);
        fflush(stdin);

        switch (command)
        {
            case 'i':
                MakeEmptyStack(myStack);
                break;
            case 't':
                val = TopOfStack(myStack);
                if (val != -1)
                    printf("top element is %d\n", val);
                break;
            case 'P':
                printf("Enter the string: ");
                scanf("%s",input);
                balanceStack(myStack,input);
                break;
            case 'e':
                exit = TRUE;
                break;
            default:
                printf("command not recognized\n");
                break;
        }
    }

    printf("\n");
    system("PAUSE");
    return 0;
}

//This function initialises a stack with a dummy node
Stack CreateStack()
{
    Stack s= malloc(sizeof (struct Node));
    if(s==NULL){
        printf("Error allocating memory.\n");
    }
    s->next=NULL;
    return s;
}

//This function empties the content of a stack
void MakeEmptyStack(Stack s)
{
    if(s->next!=NULL){
        while(!IsEmptyStack(s))
            PopStack(s);
    }
}

//This function checks if a stack is empty or not
int IsEmptyStack(Stack s)
{
    if(s->next==NULL)
        return 1;
    else
        return 0;
}

//This function checks if a stack is full
int IsFullStack(Stack s)
{
    return FALSE;
}

//This function creates a new node, adds the value of x to this node
//and then pushes this new node to the given stack
void PushStack(char x, Stack s)
{
    Stack new_node= malloc(sizeof(struct Node));
    if(new_node==NULL) {
        printf("Error allocating new node.\n");
    }
    else {
        new_node->val = x;
        new_node->next = s->next;
        s->next = new_node;
    }

}

//This function pops the top node from the stack frees the memory location
//of that node and returns the value stored in that top node
int PopStack(Stack s)
{
    Stack remove_node;
    int popval;
    if(IsEmptyStack(s))
        printf("Error. Stack is empty\n");
    else{
        remove_node=s->next;
        popval= remove_node->val;
        s->next=remove_node->next;
        free(remove_node);
        return popval;
    }
}

//This function returns the value stored at the top node
int TopOfStack(Stack s)
{
    if(!IsEmptyStack(s))
    return s->next->val;
    else{
        printf("Stack s empty\n");
        return EMPTY_TOS;
    }
}

void balanceStack(Stack s,char *string){

    int i=0;
    char character;

    while(string[i]!='\0'){
        character=string[i];
        if(character=='(')
            PushStack('(',s);
        else if(character==')'){
            if(IsEmptyStack(s))
                printf("Closing parentheses doesnt match.\n");
            else
                PopStack(s);
        }
        i++;
    }
    if(!IsEmptyStack(s))
        printf("Opening parentheses doesnt match.\n");
    else
        printf("The stack is balanced.\n");



}
